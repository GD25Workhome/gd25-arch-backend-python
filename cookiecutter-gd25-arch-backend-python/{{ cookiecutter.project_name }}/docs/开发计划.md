# {{ cookiecutter.project_name }} - 开发计划

## 一、项目概述

### 1.1 项目目标

开发一个通用的 FastAPI 后端项目，包含：
- 标准化的项目结构
- 通用的基础设施代码
- 最佳实践和约定
- 可复用的工具类

### 1.2 核心价值

- ✅ **快速启动新项目**：避免重复搭建基础框架
- ✅ **统一代码风格**：团队使用相同的项目结构
- ✅ **减少重复工作**：基础设施代码一次编写，多次使用
- ✅ **提高开发效率**：专注于业务逻辑，而不是基础设施

### 1.3 技术栈

```
技术栈：
├── FastAPI              # Web 框架
├── SQLAlchemy           # ORM 框架
├── Alembic              # 数据库迁移
├── Pydantic             # 数据验证
{% if cookiecutter.include_celery == 'y' %}
├── Celery               # 异步任务队列
{% endif %}
{% if cookiecutter.include_websocket == 'y' %}
├── WebSocket            # 实时通信
{% endif %}
└── {{ cookiecutter.database_type }}     # 数据库支持
```

---

## 二、开发原则

### 2.1 设计原则

- **通用性优先**：只包含通用的基础设施代码
- **业务无关**：不包含任何业务逻辑
- **可扩展性**：提供扩展点，允许项目自定义
- **可选模块**：通过参数控制是否包含可选功能

### 2.2 代码规范

- 使用详细的简体中文注释和文档字符串
- 函数和类必须有完整的类型提示
- 异常处理要完善，提供有用的错误信息
- 遵循 PEP 8 代码风格

---

## 三、项目结构说明

### 3.1 核心模块

| 模块 | 文件路径 | 说明 |
|------|----------|------|
| 配置管理 | `app/config.py` | 环境变量、配置验证 |
| 数据库连接 | `app/db/database.py` | SQLAlchemy 连接配置 |
| 基础模型 | `app/db/base.py` | BaseModel（id, created_at, updated_at） |
| 会话管理 | `app/db/session.py` | 数据库会话管理 |
| 日志工具 | `app/utils/logger.py` | 日志配置和格式化 |
| ID 生成器 | `app/utils/id_generator.py` | 通用ID生成方法 |
| 依赖注入 | `app/dependencies.py` | 基础依赖注入模式 |
| 主应用入口 | `app/main.py` | FastAPI 应用配置 |
| Alembic 配置 | `alembic/env.py` | 数据库迁移配置 |

### 3.2 可选模块

{% if cookiecutter.include_celery == 'y' %}
| 模块 | 文件路径 | 说明 |
|------|----------|------|
| Celery 配置 | `app/tasks/celery_app.py` | 异步任务队列 |
| Celery 基础类 | `app/tasks/base.py` | 基础任务类和装饰器 |
| Celery 示例 | `app/tasks/examples.py` | 任务示例代码 |
{% endif %}

{% if cookiecutter.include_websocket == 'y' %}
| 模块 | 文件路径 | 说明 |
|------|----------|------|
| WebSocket 管理器 | `app/websocket/manager.py` | 连接管理 |
| WebSocket 处理器 | `app/websocket/handler.py` | 基础处理器 |
{% endif %}

---

## 四、快速开始

### 4.1 环境准备

1. **Python 环境**：{{ cookiecutter.python_version }}+
2. **数据库**：{{ cookiecutter.database_type }}
{% if cookiecutter.include_celery == 'y' %}
3. **消息队列**：RabbitMQ 或 Redis（用于 Celery）
{% endif %}

### 4.2 安装依赖

```bash
# 安装核心依赖
pip install -r requirements.txt

# 安装开发依赖（可选）
pip install -r requirements-dev.txt
```

### 4.3 配置环境变量

```bash
# 复制环境变量示例文件
cp env.example .env

# 编辑 .env 文件，配置数据库连接等信息
```

### 4.4 初始化数据库

```bash
# 创建数据库迁移脚本
alembic revision --autogenerate -m "Initial migration"

# 执行数据库迁移
alembic upgrade head
```

### 4.5 启动服务

```bash
# 开发环境
uvicorn app.main:app --reload

# 或使用启动脚本
./scripts/start_dev.sh
```

---

## 五、开发建议

### 5.1 项目初始化检查清单

- [ ] 安装依赖（requirements.txt）
- [ ] 配置环境变量（.env）
- [ ] 初始化数据库（Alembic）
- [ ] 测试健康检查接口（`/health`）
- [ ] 测试 API 文档（`/docs`）

### 5.2 开发流程建议

1. **先理解项目结构**：阅读 README 和文档，了解各模块的作用
2. **配置环境**：确保数据库等基础设施已就绪
3. **运行测试**：执行 `pytest` 确保项目功能正常
4. **创建第一个模型**：从简单的业务模型开始
5. **创建第一个 API**：实现简单的 CRUD 接口
6. **逐步扩展**：根据业务需求逐步添加功能

### 5.3 自定义扩展建议

#### 扩展配置

```python
# app/config.py 或新建 app/project_config.py
from app.config import Settings
from pydantic import Field

class ProjectSettings(Settings):
    """项目自定义配置"""
    api_key: str = Field(..., description="API 密钥")
    max_retries: int = Field(default=3, ge=1, le=10)

project_settings = ProjectSettings()
```

#### 扩展 Repository

```python
# app/repositories/user_repository.py
from app.repositories.base import BaseRepository
from app.models.user import User
from sqlalchemy.orm import Session

class UserRepository(BaseRepository[User]):
    """用户 Repository"""
    
    def __init__(self, db: Session):
        super().__init__(User, db)
    
    def get_by_email(self, email: str) -> User | None:
        """根据邮箱获取用户"""
        return self.filter_one(User.email == email)
```

#### 添加业务 API

```python
# app/api/users.py
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from app.dependencies import get_db
from app.repositories.user_repository import UserRepository

router = APIRouter(prefix="/users", tags=["用户"])

@router.get("/")
async def get_users(db: Session = Depends(get_db)):
    """获取用户列表"""
    repo = UserRepository(db)
    return repo.get_all()
```

```python
# app/main.py
from app.api import users

# 注册路由
app.include_router(users.router, prefix="/api/v1")
```

---

## 六、文档说明

### 6.1 项目文档

- **README.md**：项目说明和使用指南
- **快速开始指南**：`docs/边做边学/快速开始指南.md`
- **示例代码说明**：`docs/边做边学/示例代码使用说明.md`
{% if cookiecutter.include_celery == 'y' %}
- **Celery 监控配置**：`docs/边做边学/flower监控配置说明.md`
{% endif %}
{% if cookiecutter.include_websocket == 'y' %}
- **WebSocket 测试说明**：`docs/边做边学/websocket测试说明.md`
- **WebSocket 基础原理**：`docs/边做边学/websocket基础原理.md`
{% endif %}

### 6.2 使用文档

更多使用说明请参考 `docs/边做边学/` 目录下的文档。

---

**文档版本**：v1.0  
**创建时间**：{{ "{{ cookiecutter.project_name }}" }} 项目生成时  
**最后更新**：请根据实际情况更新
