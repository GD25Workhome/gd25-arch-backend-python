# FastAPI åç«¯è„šæ‰‹æ¶ - å¿«é€Ÿå¼€å§‹æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ åœ¨ 10 åˆ†é’Ÿå†…å¿«é€Ÿå¯åŠ¨ä¸€ä¸ªæ–°é¡¹ç›®ã€‚

## ä¸€ã€å‰ç½®è¦æ±‚

- Python 3.10+
- PostgreSQL 14+ æˆ– MySQL 8.0+ï¼ˆç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰
- Git
- åŸºæœ¬çš„ Python å’Œ FastAPI çŸ¥è¯†

## äºŒã€å¿«é€Ÿå¼€å§‹ï¼ˆ5 æ­¥ï¼‰

### æ­¥éª¤ 1ï¼šå…‹éš†è„šæ‰‹æ¶ï¼ˆ1 åˆ†é’Ÿï¼‰

```bash
# å…‹éš†è„šæ‰‹æ¶ä»“åº“
git clone https://github.com/your-org/gd25-arch-backend-python my-project

# è¿›å…¥é¡¹ç›®ç›®å½•
cd my-project

# åˆ é™¤åŸæœ‰çš„ Git å†å²ï¼Œé‡æ–°åˆå§‹åŒ–
rm -rf .git
git init
```

### æ­¥éª¤ 2ï¼šé…ç½®ç¯å¢ƒï¼ˆ2 åˆ†é’Ÿï¼‰

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èä½¿ç”¨ condaï¼‰
conda create -n my-project python=3.10
conda activate my-project

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
# æ³¨æ„ï¼šå¦‚æœ env.example ä¸å­˜åœ¨ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»º .env æ–‡ä»¶
# è‡³å°‘éœ€è¦é…ç½® DATABASE_URL
```

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# .env
APP_NAME=my-project
APP_VERSION=1.0.0
ENVIRONMENT=development
DEBUG=true

# æ•°æ®åº“é…ç½®ï¼ˆå¿…éœ€ï¼‰
DATABASE_URL=postgresql://user:password@localhost:5432/mydb
# æˆ– MySQL:
# DATABASE_URL=mysql+pymysql://user:password@localhost:3306/mydb

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO
LOG_FORMAT=json
```

### æ­¥éª¤ 3ï¼šåˆå§‹åŒ–æ•°æ®åº“ï¼ˆ1 åˆ†é’Ÿï¼‰

```bash
# æ–¹å¼ 1ï¼šä½¿ç”¨æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰
# è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
python scripts/init_db.py

# å¦‚æœéœ€è¦å®‰è£… PostgreSQL pgvector æ‰©å±•ï¼ˆä»… PostgreSQLï¼‰
python scripts/init_db.py --install-pgvector

# æ–¹å¼ 2ï¼šæ‰‹åŠ¨åˆ›å»ºæ•°æ®åº“
# PostgreSQL:
# psql -U postgres
# CREATE DATABASE mydb;

# MySQL:
# mysql -u root -p
# CREATE DATABASE mydb;
```

```bash
# åˆ›å»ºæ•°æ®åº“è¿ç§»è„šæœ¬
alembic revision --autogenerate -m "Initial migration"

# æ‰§è¡Œæ•°æ®åº“è¿ç§»
alembic upgrade head
```

### æ­¥éª¤ 4ï¼šå¯åŠ¨æœåŠ¡ï¼ˆ30 ç§’ï¼‰

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uvicorn app.main:app --reload

# æˆ–ä½¿ç”¨å¯åŠ¨è„šæœ¬
./scripts/start_dev.sh
```

### æ­¥éª¤ 5ï¼šéªŒè¯è¿è¡Œï¼ˆ30 ç§’ï¼‰

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥æ¥å£
curl http://localhost:8000/health

# è®¿é—® API æ–‡æ¡£
# æµè§ˆå™¨æ‰“å¼€ï¼šhttp://localhost:8000/docs
```

## ä¸‰ã€ä¸‹ä¸€æ­¥ï¼šä½¿ç”¨ç¤ºä¾‹ä»£ç 

è„šæ‰‹æ¶æä¾›äº†å®Œæ•´çš„ç”¨æˆ·ç®¡ç†ç¤ºä¾‹ä»£ç ï¼Œä½ å¯ä»¥ï¼š

1. **æŸ¥çœ‹ç¤ºä¾‹ä»£ç **ï¼š
   - Model: `app/models/user.py`
   - Schema: `app/schemas/user.py`
   - Repository: `app/repositories/user_repository.py`
   - Service: `app/services/user_service.py`
   - API: `app/api/users.py`

2. **æ³¨å†Œç¤ºä¾‹è·¯ç”±**ï¼ˆåœ¨ `app/main.py` ä¸­ï¼‰ï¼š
   ```python
   from app.api.users import router as users_router
   app.include_router(users_router, prefix="/api/v1")
   ```

3. **æµ‹è¯•ç¤ºä¾‹ API**ï¼š
   - è®¿é—® http://localhost:8000/docs
   - å°è¯•åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ç”¨æˆ·

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒï¼š[ç¤ºä¾‹ä»£ç ä½¿ç”¨è¯´æ˜](./ç¤ºä¾‹ä»£ç ä½¿ç”¨è¯´æ˜.md)

## å››ã€å¼€å‘ä½ çš„ç¬¬ä¸€ä¸ªåŠŸèƒ½

### 4.1 åˆ›å»ºæ¨¡å‹

```python
# app/models/product.py
from app.db.base import BaseModel
from sqlalchemy import Column, String, Float

class Product(BaseModel):
    __tablename__ = "products"
    
    name = Column(String(100), nullable=False)
    price = Column(Float, nullable=False)
```

### 4.2 åˆ›å»º Schema

```python
# app/schemas/product.py
from pydantic import BaseModel

class ProductCreate(BaseModel):
    name: str
    price: float

class ProductResponse(BaseModel):
    id: int
    name: str
    price: float
```

### 4.3 åˆ›å»º Repository

```python
# app/repositories/product_repository.py
from app.repositories.base import BaseRepository
from app.models.product import Product

class ProductRepository(BaseRepository[Product]):
    def __init__(self, db: Session):
        super().__init__(Product, db)
```

### 4.4 åˆ›å»º Service

```python
# app/services/product_service.py
from app.repositories.product_repository import ProductRepository
from app.schemas.product import ProductCreate

class ProductService:
    def __init__(self, db: Session):
        self.repository = ProductRepository(db)
    
    def create_product(self, product_data: ProductCreate):
        return self.repository.create(product_data.model_dump())
```

### 4.5 åˆ›å»º API

```python
# app/api/products.py
from fastapi import APIRouter, Depends
from app.services.product_service import ProductService
from app.dependencies import get_db

router = APIRouter(prefix="/products", tags=["äº§å“"])

@router.post("/")
async def create_product(
    product_data: ProductCreate,
    db: Session = Depends(get_db)
):
    service = ProductService(db)
    product = service.create_product(product_data)
    return product
```

### 4.6 æ³¨å†Œè·¯ç”±

åœ¨ `app/main.py` ä¸­ï¼š

```python
from app.api.products import router as products_router
app.include_router(products_router, prefix="/api/v1")
```

### 4.7 æ•°æ®åº“è¿ç§»

```bash
alembic revision --autogenerate -m "Add product model"
alembic upgrade head
```

## äº”ã€å¸¸ç”¨å‘½ä»¤

### å¼€å‘

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uvicorn app.main:app --reload

# è¿è¡Œæµ‹è¯•
pytest

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=app --cov-report=html
```

### æ•°æ®åº“

```bash
# åˆ›å»ºè¿ç§»è„šæœ¬
alembic revision --autogenerate -m "æè¿°"

# æ‰§è¡Œè¿ç§»
alembic upgrade head

# å›æ»šè¿ç§»
alembic downgrade -1

# æŸ¥çœ‹è¿ç§»å†å²
alembic history
```

### ä»£ç è´¨é‡

```bash
# æ ¼å¼åŒ–ä»£ç ï¼ˆå¦‚æœå®‰è£…äº† blackï¼‰
black app/

# æ£€æŸ¥ä»£ç é£æ ¼ï¼ˆå¦‚æœå®‰è£…äº† flake8ï¼‰
flake8 app/

# ç±»å‹æ£€æŸ¥ï¼ˆå¦‚æœå®‰è£…äº† mypyï¼‰
mypy app/
```

## å…­ã€é¡¹ç›®ç»“æ„è¯´æ˜

```
my-project/
â”œâ”€â”€ app/                    # åº”ç”¨ä¸»ç›®å½•
â”‚   â”œâ”€â”€ api/                # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ users.py        # ç”¨æˆ· APIï¼ˆç¤ºä¾‹ï¼‰
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ models/             # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ user.py        # ç”¨æˆ·æ¨¡å‹ï¼ˆç¤ºä¾‹ï¼‰
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ schemas/            # Pydantic Schema
â”‚   â”‚   â”œâ”€â”€ user.py        # ç”¨æˆ· Schemaï¼ˆç¤ºä¾‹ï¼‰
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ repositories/       # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ base.py        # Repository åŸºç±»
â”‚   â”‚   â”œâ”€â”€ user_repository.py  # ç”¨æˆ· Repositoryï¼ˆç¤ºä¾‹ï¼‰
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ user_service.py  # ç”¨æˆ·æœåŠ¡ï¼ˆç¤ºä¾‹ï¼‰
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ db/                 # æ•°æ®åº“ç›¸å…³
â”‚   â”œâ”€â”€ utils/              # å·¥å…·ç±»
â”‚   â”œâ”€â”€ config.py           # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ main.py             # åº”ç”¨å…¥å£
â”œâ”€â”€ tests/                  # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ alembic/                # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ docs/                    # æ–‡æ¡£
â”œâ”€â”€ requirements.txt        # ä¾èµ–
â””â”€â”€ .env                    # ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤åˆ° Gitï¼‰
```

## ä¸ƒã€å¸¸è§é—®é¢˜

### Q1: æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Ÿ

**A**: 
1. æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `DATABASE_URL` æ˜¯å¦æ­£ç¡®
2. ç¡®ä¿æ•°æ®åº“æœåŠ¡å·²å¯åŠ¨
3. å¦‚æœæ•°æ®åº“ä¸å­˜åœ¨ï¼Œè¿è¡Œ `python scripts/init_db.py` è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“
4. ç¡®ä¿æ•°æ®åº“ç”¨æˆ·æœ‰è¶³å¤Ÿçš„æƒé™ï¼ˆåˆ›å»ºæ•°æ®åº“ã€åˆ›å»ºè¡¨ç­‰ï¼‰

### Q1.1: å¦‚ä½•åˆå§‹åŒ–æ•°æ®åº“ï¼Ÿ

**A**: ä½¿ç”¨æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ï¼š
```bash
# åˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
python scripts/init_db.py

# åˆ›å»ºæ•°æ®åº“å¹¶å®‰è£… pgvector æ‰©å±•ï¼ˆä»… PostgreSQLï¼‰
python scripts/init_db.py --install-pgvector
```

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒï¼š[æ•°æ®åº“åˆå§‹åŒ–ä½¿ç”¨è¯´æ˜](./æ•°æ®åº“åˆå§‹åŒ–ä½¿ç”¨è¯´æ˜.md)

### Q2: å¦‚ä½•æ·»åŠ æ–°çš„é…ç½®é¡¹ï¼Ÿ

**A**: ç»§æ‰¿ `Settings` ç±»æ·»åŠ è‡ªå®šä¹‰é…ç½®é¡¹ï¼Œå‚è€ƒ `app/config.py` ä¸­çš„æ³¨é‡Šã€‚

### Q3: å¦‚ä½•æ·»åŠ è®¤è¯ï¼Ÿ

**A**: åœ¨ `app/dependencies.py` ä¸­æ·»åŠ è®¤è¯ä¾èµ–ï¼Œå‚è€ƒæ–‡æ¡£ä¸­çš„æ‰©å±•è¯´æ˜ã€‚

### Q4: å¦‚ä½•è¿è¡Œæµ‹è¯•ï¼Ÿ

**A**: è¿è¡Œ `pytest`ï¼Œæµ‹è¯•ä½¿ç”¨ SQLite å†…å­˜æ•°æ®åº“ï¼Œæ— éœ€é…ç½®å®é™…æ•°æ®åº“ã€‚

### Q5: å¦‚ä½•éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼Ÿ

**A**: 
1. è®¾ç½® `ENVIRONMENT=production`
2. é…ç½®ç”Ÿäº§æ•°æ®åº“
3. ä½¿ç”¨ `gunicorn` æˆ– `uvicorn` éƒ¨ç½²
4. å‚è€ƒ `scripts/start_prod.sh`

## å…«ã€å‚è€ƒèµ„æº

- [é¡¹ç›® README](../README.md)
- [ç¤ºä¾‹ä»£ç ä½¿ç”¨è¯´æ˜](./ç¤ºä¾‹ä»£ç ä½¿ç”¨è¯´æ˜.md)
- [Repository ä½¿ç”¨ç¤ºä¾‹](./repositoryä½¿ç”¨ç¤ºä¾‹.md)
- [å¯åŠ¨æ–¹å¼è¯´æ˜](./å¯åŠ¨æ–¹å¼è¯´æ˜.md)
- [æµ‹è¯•æ‰§è¡Œè¯´æ˜](./æµ‹è¯•æ‰§è¡Œè¯´æ˜.md)
- [FastAPI å®˜æ–¹æ–‡æ¡£](https://fastapi.tiangolo.com/)

## ä¹ã€è·å–å¸®åŠ©

- æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£ï¼š`docs/` ç›®å½•
- æŸ¥çœ‹ç¤ºä¾‹ä»£ç ï¼š`app/models/`, `app/api/` ç­‰ç›®å½•
- æäº¤ Issueï¼šGitHub Issues
- æŸ¥çœ‹å¼€å‘è®¡åˆ’ï¼š`../å¼€å‘è®¡åˆ’.md`

---

**ç¥ä½ å¼€å‘æ„‰å¿«ï¼** ğŸš€

